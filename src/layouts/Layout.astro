---
import { ViewTransitions } from 'astro:transitions';
import '../styles/global.css';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

interface Props {
  title: string;
  description?: string;
  ogImage?: string;
  bgSaturated?: boolean;
  article?: {
    publishedDate: Date;
    modifiedDate?: Date;
  };
}

const {
  title,
  description = "Nate will level up your design eye and help your brand or business stand out online. Join his weekly newsletter, read his writing, or bring him on as your design partner.",
  ogImage = "/og-image.jpg",
  bgSaturated = false,
  article
} = Astro.props;

const siteUrl = "https://www.kadlac.com";
const canonicalUrl = new URL(Astro.url.pathname, siteUrl).href;
const fullOgImage = ogImage.startsWith('http') ? ogImage : `${siteUrl}${ogImage}`;

// JSON-LD Schemas
const websiteSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Nate Kadlac",
  "url": siteUrl,
  "description": "Design education for non-designers and solopreneurs",
  "author": {
    "@type": "Person",
    "name": "Nate Kadlac"
  }
};

const personSchema = {
  "@context": "https://schema.org",
  "@type": "Person",
  "name": "Nate Kadlac",
  "url": siteUrl,
  "jobTitle": "Designer, Writer, & Instructor",
  "sameAs": [
    "https://twitter.com/kadlac",
    "https://www.linkedin.com/in/natekadlac/",
    "https://www.youtube.com/@natekadlac"
  ]
};

const articleSchema = article ? {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": title,
  "description": description,
  "image": fullOgImage,
  "author": {
    "@type": "Person",
    "name": "Nate Kadlac",
    "url": siteUrl
  },
  "publisher": {
    "@type": "Person",
    "name": "Nate Kadlac"
  },
  "datePublished": article.publishedDate.toISOString(),
  ...(article.modifiedDate && { "dateModified": article.modifiedDate.toISOString() }),
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": canonicalUrl
  }
} : null;
---

<!doctype html>
<html lang="en" class:list={[bgSaturated && 'bg-saturated']}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />

    <!-- Favicons -->
    <link href="/favicon-light.png" rel="icon" media="(prefers-color-scheme: light)" />
    <link href="/favicon-dark.png" rel="icon" media="(prefers-color-scheme: dark)" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

    <!-- SEO -->
    <link rel="canonical" href={canonicalUrl} />
    <link rel="alternate" type="application/rss+xml" title="Nate Kadlac RSS Feed" href="/rss.xml" />

    <!-- Open Graph / Social -->
    <meta property="og:type" content={article ? "article" : "website"} />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={fullOgImage} />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={fullOgImage} />

    <meta name="generator" content={Astro.generator} />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />

    <title>{title}</title>

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />
    <script type="application/ld+json" set:html={JSON.stringify(personSchema)} />
    {articleSchema && (
      <script type="application/ld+json" set:html={JSON.stringify(articleSchema)} />
    )}

    <!-- Plausible Analytics -->
    <script async src="https://plausible.io/js/pa-1OPy4ORLTH4RoaAr1EAAh.js"></script>
    <script>
      window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};
      plausible.init()
    </script>

    <!-- Fathom Analytics -->
    <script src="https://cdn.usefathom.com/script.js" data-site="GBPESUHG" defer></script>

    <ViewTransitions />
  </head>
  <body class="flex flex-col min-h-screen">
    <Header bgSaturated={bgSaturated} />
    <main class="flex-1">
      <slot />
    </main>
    <Footer />
  </body>
</html>
